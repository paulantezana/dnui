---
import Layout from '../../layouts/Layout.astro';
import CodeBox from '../../components/CodeBox.astro';
---

<Layout
  title="Table Component"
  description="A data table component with filtering, sorting, and pagination capabilities."
>
  <div>
    <h2>Basic Usage</h2>
    <CodeBox
      title="Simple Table"
      description="Create a basic table with actions"
      examples={[
        {
          language: 'html',
          code: ''
        }
      ]}
    >
      <div class="dn-table-wrapper">
        <table class="dn-table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Email</th>
              <th>Role</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>John Doe</td>
              <td>john@example.com</td>
              <td>Admin</td>
            </tr>
            <tr>
              <td>Jane Smith</td>
              <td>jane@example.com</td>
              <td>User</td>
            </tr>
            <tr>
              <td>Bob Johnson</td>
              <td>bob@example.com</td>
              <td>Editor</td>
            </tr>
          </tbody>
        </table>
      </div>
    </CodeBox>
    <CodeBox
      title="Simple Table"
      description="Create a basic table with actions"
      examples={[
        {
          language: 'html',
          code: ''
        }
      ]}
    >
      <div class="dn-table-wrapper">
        <table class="dn-table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Email</th>
              <th>Role</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>John Doe</td>
              <td>john@example.com</td>
              <td>Admin</td>
            </tr>
            <tr>
              <td>Jane Smith</td>
              <td>jane@example.com</td>
              <td>User</td>
            </tr>
            <tr>
              <td>Bob Johnson</td>
              <td>bob@example.com</td>
              <td>Editor</td>
            </tr>
          </tbody>
          <tfoot>
            <tr>
              <td>todo</td>
              <td>15</td>
              <td>1</td>
            </tr>
          </tfoot>
        </table>
      </div>
    </CodeBox>
    <CodeBox
      title="Simple Table"
      description="Create a basic table with actions"
      examples={[
        {
          language: 'html',
          code: ''
        }
      ]}
    >
      <div class="dn-table-wrapper">
        <table class="dn-table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Email</th>
              <th>Role</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>John Doe</td>
              <td>john@example.com</td>
              <td>Admin</td>
              <td>
                <div class="dn-flex gap">
                  <button class="dn-btn">Edit</button>
                  <button class="dn-btn danger">Delete</button>
                </div>
              </td>
            </tr>
            <tr>
              <td>Jane Smith</td>
              <td>jane@example.com</td>
              <td>User</td>
              <td>
                <div class="dn-flex gap">
                  <button class="dn-btn">Edit</button>
                  <button class="dn-btn danger">Delete</button>
                </div>
              </td>
            </tr>
            <tr>
              <td>Bob Johnson</td>
              <td>bob@example.com</td>
              <td>Editor</td>
              <td>
                <div class="dn-flex gap">
                  <button class="dn-btn">Edit</button>
                  <button class="dn-btn danger">Delete</button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </CodeBox>
    <CodeBox
      title="Advanced Table"
      description="Data table with filtering, sorting, and pagination"
      examples={[]}
    >
      <div id="advancedTable" style="height: 80vh;"></div>
      <script is:inline>
        document.addEventListener('DOMContentLoaded', function () {
          new window.PdTable({
            elementId: 'advancedTable',
            entity: 'user',
            toolbar: '<button>aditional buttion</button>',
            actions: [
              {
                id: 43,
                title: 'Imprimir A4',
                // "description": "Imprimir A4",
                icon: 'fas fa-print',
                event_name: 'PrintA4',
                event_name_prefix: '',
                // "parent_id": 0,
                // "sort_order": 13,
                position: 'TABLE',
                // "class_names": "radio",
                // "type": "button",
                // "keyboard_key": "",
                // "state": 1,
                // "updated_at": null,
                // "created_at": null,
                // "created_user": "",
                // "updated_user": "",
                screen_id_controller: 'processSale'
                // visible: () => false,
              }
            ],
            columns: [
              {
                title: 'Fecha Registro',
                field: 'register_datetime',
                filterable: true,
                sortable: true,
                type: 'date'
              },
              {
                title: 'Fecha Emisión',
                field: 'date_of_issue',
                filterable: true,
                sortable: true,
                type: 'date'
              },
              {
                title: 'Fecha Vencimiento',
                field: 'date_of_due',
                filterable: true,
                sortable: true,
                visible: false,
                type: 'date'
              },
              {
                title: 'Tipo Doc.',
                field: 'document_type_id_description',
                filterable: true,
                sortable: true
              },
              {
                title: 'Documento',
                field: 'document',
                filterable: true,
                sortable: true
              },
              {
                title: 'RUC / DNI / ETC',
                field: 'document_number',
                filterable: true,
                sortable: true
              },
              {
                title: 'Denominación',
                field: 'social_reason',
                filterable: true,
                sortable: true
              },
              {
                title: 'Placa vehicular',
                field: 'vehicle_plate',
                filterable: true,
                sortable: true,
                visible: false
              },
              {
                title: 'Orden compra',
                field: 'purchase_order',
                filterable: true,
                sortable: true,
                visible: false
              },
              {
                title: 'Guia',
                field: 'guide',
                filterable: true,
                sortable: true,
                visible: false
              },
              {
                title: 'Observación',
                field: 'observation',
                filterable: true,
                sortable: true,
                visible: false
              },
              {
                title: 'Gratuita',
                field: 'total_free',
                summaryOperator: 'sum',
                type: 'number',
                filterable: true,
                sortable: true,
                customRender: (item) => {
                  return `${item.currency_id_symbol} ${item.total_free}`;
                }
              },
              {
                title: 'Exportacion',
                field: 'total_exportation',
                summaryOperator: 'sum',
                type: 'number',
                filterable: true,
                sortable: true,
                visible: false,
                customRender: (item) => {
                  return `${item.currency_id_symbol} ${item.total_exportation}`;
                }
              },
              {
                title: 'Descuento',
                field: 'total_discount',
                summaryOperator: 'sum',
                type: 'number',
                filterable: true,
                sortable: true,
                visible: false,
                customRender: (item) => {
                  return `${item.currency_id_symbol} ${item.total_discount}`;
                }
              },
              {
                title: 'Exonerado',
                field: 'total_exonerated',
                summaryOperator: 'sum',
                type: 'number',
                filterable: true,
                sortable: true,
                visible: false,
                customRender: (item) => {
                  return `${item.currency_id_symbol} ${item.total_exonerated}`;
                }
              },
              {
                title: 'Inafecto',
                field: 'total_unaffected',
                summaryOperator: 'sum',
                type: 'number',
                filterable: true,
                sortable: true,
                visible: false,
                customRender: (item) => {
                  return `${item.currency_id_symbol} ${item.total_unaffected}`;
                }
              },
              {
                title: 'Gravada',
                field: 'total_taxed',
                summaryOperator: 'sum',
                type: 'number',
                filterable: true,
                sortable: true,
                visible: false,
                customRender: (item) => {
                  return `${item.currency_id_symbol} ${item.total_taxed}`;
                }
              },
              {
                title: 'Total IGV',
                field: 'total_igv',
                summaryOperator: 'sum',
                type: 'number',
                filterable: true,
                sortable: true,
                visible: false,
                customRender: (item) => {
                  return `${item.currency_id_symbol} ${item.total_igv}`;
                }
              },
              {
                title: 'IGV factor',
                field: 'tax_factor',
                filterable: true,
                sortable: true,
                visible: false,
                customRender: (item) => {
                  return `${parseFloat(item.tax_factor || 0).toFixed(2)}`;
                }
              },
              {
                title: 'Otros car.',
                field: 'total_charge',
                summaryOperator: 'sum',
                type: 'number',
                filterable: true,
                sortable: true,
                visible: false,
                customRender: (item) => {
                  return `${item.currency_id_symbol} ${item.total_charge}`;
                }
              },
              {
                title: 'ICBPER',
                field: 'total_plastic_bag_tax',
                summaryOperator: 'sum',
                type: 'number',
                filterable: true,
                sortable: true,
                visible: false,
                customRender: (item) => {
                  return `${item.currency_id_symbol} ${item.total_plastic_bag_tax}`;
                }
              },
              {
                title: 'Vuelto',
                field: 'returned',
                summaryOperator: 'sum',
                type: 'number',
                filterable: true,
                sortable: true,
                visible: false,
                customRender: (item) => {
                  return `${item.currency_id_symbol} ${item.returned}`;
                }
              },
              {
                title: 'Total',
                field: 'total',
                type: 'number',
                summaryOperator: 'sum',
                filterable: true,
                sortable: true,
                customRender: (item) => {
                  return `${item.currency_id_symbol} ${item.total}`;
                }
              },
              {
                title: 'Correo',
                field: 'email',
                filterable: true,
                sortable: true,
                visible: false
              },
              {
                title: 'Celular',
                field: 'phone',
                filterable: true,
                sortable: true,
                visible: false
              },
              {
                title: 'Observación',
                field: 'observation',
                filterable: true,
                sortable: true
              },
              {
                title: 'Usuario',
                field: 'user_id_user_name',
                filterable: true,
                sortable: true
              },
              {
                title: 'Metodo',
                field: 'summary_payment_method_id_description',
                filterable: true,
                sortable: true
                // customRender: (item) => {
                //   return item.summary_payment_method_id_description;
                //   // return `<span><span class="pd-badge ${item.payment_form_id == '1' ? 'success' : 'warning'} pd-mr-1"></span>${item.payment_form_id_description}</span>`;
                // }
              },
              {
                title: 'Pago',
                field: 'payment_form_id_description',
                filterable: true,
                sortable: true,
                customRender: (item) => {
                  return `<span><span class="pd-badge ${item.payment_form_id == '1' ? 'success' : 'warning'} pd-mr-1"></span>${item.payment_form_id_description}</span>`;
                },
                filterValues: async () => ['Contado', 'Credito']
              },
              {
                title: 'Estado',
                field: 'sale_state_id_description',
                filterable: true,
                sortable: true,
                customRender: (item) => {
                  let color = '';
                  switch (`${item.sale_state_id}`) {
                    case '1': // Anulado
                      color = 'danger';
                      break;
                    case '2': // Pendiente
                      color = 'danger';
                      break;
                    case '3': // Guardado
                      color = 'primary';
                      break;
                    case '4': // Emitido
                      color = 'success';
                      break;
                    case '6': // Excepcion de SUNAT
                    case '8': // Rechazado
                      color = 'danger';
                      break;
                    case '9': // Observaciones
                      color = 'warning';
                      break;
                    default:
                      break;
                  }
                  return `<span class="pd-tag ${color} pd-mr-1">${item.sale_state_id_description}</span>`;
                },
                filterValues: async () => [
                  'Anulado',
                  'Pendiente',
                  'Guardado',
                  'Emitido',
                  'Excepcion de SUNAT',
                  'Rechazado',
                  'Observaciones'
                ]
              }
            ],
            data: async (content) => {
              const response = await fetch(
                'https://assets.paulantezana.com/sale.php',
                {
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/json'
                  },
                  body: JSON.stringify(content)
                }
              );

              if (!response.ok) {
                throw new Error(`Error en la solicitud: ${response.status}`);
              }

              const responseJson = await response.json();

              if (!responseJson.success) {
                throw new Error(
                  responseJson.message || 'Error en la respuesta del servidor'
                );
              }

              return responseJson.result;
            },
            onSelectChange: (that) => {}
          });
        });
      </script>
    </CodeBox>
  </div>
</Layout>
